<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>冰糖炖雪梨</title>
    <meta name="generator" content="VuePress 1.4.1">
    <link rel="apple-touch-icon" sizes="57x57" href="/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/manifest.json">
    <meta name="description" content="">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <link rel="preload" href="/assets/css/0.styles.a47b451b.css" as="style"><link rel="preload" href="/assets/js/app.311b719d.js" as="script"><link rel="preload" href="/assets/js/2.b192e365.js" as="script"><link rel="preload" href="/assets/js/9.9f67e139.js" as="script"><link rel="prefetch" href="/assets/js/10.bfc7237a.js"><link rel="prefetch" href="/assets/js/11.787e0703.js"><link rel="prefetch" href="/assets/js/12.3336fcf3.js"><link rel="prefetch" href="/assets/js/13.9bff7af3.js"><link rel="prefetch" href="/assets/js/14.a3dd6056.js"><link rel="prefetch" href="/assets/js/15.3f7bf20e.js"><link rel="prefetch" href="/assets/js/16.4e2855a3.js"><link rel="prefetch" href="/assets/js/17.87ce42d8.js"><link rel="prefetch" href="/assets/js/18.b875cc96.js"><link rel="prefetch" href="/assets/js/19.6c4d285b.js"><link rel="prefetch" href="/assets/js/20.dab1b035.js"><link rel="prefetch" href="/assets/js/3.4806f758.js"><link rel="prefetch" href="/assets/js/4.befeb71f.js"><link rel="prefetch" href="/assets/js/5.9dd69879.js"><link rel="prefetch" href="/assets/js/6.42760052.js"><link rel="prefetch" href="/assets/js/7.0e3b7fc3.js"><link rel="prefetch" href="/assets/js/8.3dd4f9b4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a47b451b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">冰糖炖雪梨</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/electron/basic/44328ca765.html" class="nav-link">
  Electron
</a></div><div class="nav-item"><a href="/javascript/" class="nav-link">
  Javascript
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/electron/basic/44328ca765.html" class="nav-link">
  Electron
</a></div><div class="nav-item"><a href="/javascript/" class="nav-link">
  Javascript
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础知识</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/electron/basic/44328ca765.html" class="sidebar-link">为什么electron那么🔥</a></li><li><a href="/electron/basic/44328ca766.html" class="active sidebar-link">揭秘electron架构原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>揭秘Electron架构原理</p> <h1 id="chromium架构"><a href="#chromium架构" class="header-anchor">#</a> Chromium架构</h1> <p>上一节我们说过electron是基于chromium做的，因此想要了解electron，需要了解Chromium的架构。</p> <p>Chromuim本质是Chrome的开源版，也是一个浏览器，浏览器其实也是一个桌面应用，它需要去创建窗口，右键菜单，管理浏览器Tab页面还有扩展程序等等，而处理这些事项的进程我们称之为主进程，也就是下图第一个黑框Browser；而具体每一个页面的进程我们称之为渲染进程，对应的就是Render。可以看我们的一个浏览器里面，它会有一个browser，然后多个Render。</p> <p>进程之间是需要通信交互才能运转的，如果大家对Linux或者是进程有一定了解的话，两个进程需要交互就需要跨进程通信，也就是我们所说的IPC。主进程中的RenderProcessHost和RenderProcess就是专门用来处理IPC事件的。</p> <p>下面具体看看渲染进程具体的内容，RenderView，我们最熟悉的页面就是在RenderView中，基于webkit的排版展示出来的。ResourceDispatcher，用于处理资源的请求，当我们的页面需要请求资源的时候，会通过ResourceDispatcher创建一个请求ID，通过IPC转发到Broswer进程中处理，然后返回。</p> <p>★★★结：</p> <ul><li>Chromium是多进程架构，包括Broswer和多个Render</li> <li>进程间是需要IPC进行通信</li> <li>web关注的只是很小的一部分</li></ul> <p><img src="https://mwpro.oss-cn-hangzhou.aliyuncs.com/7385/4531d113ebeed8670c73541ca76799c8" alt=""></p> <h1 id="electron架构"><a href="#electron架构" class="header-anchor">#</a> Electron架构</h1> <p>由于Electron使用了Chromium来展示web页面，所以Chromium的多进程架构也会被使用到Electron中，在Electron中也分为主进程和渲染进程，但是和Chromium不一样的有两点。第一，Electron在各个进程里暴露了一些Native API；第二，引入了Node.js。于是，我们可以在Electron中可以使用Chromium和Node，比如我们可以通过Node去管理窗口，在页面中我们可以使用Node库。这其实是非常不容易的，因为在主线程中同一时间下，只能运行一个事件循环，但是Node.js它的事件循环是基于libuv，而Chromium是基于messagebump，这就是Electron原理的重点，就是如何整合事件循环？</p> <p>具体如何整合，主要的思路有两种：</p> <ol><li>Chromium集成到Node.js: 用libuv实现messagebump（nw）
2.Node.js 集成到Chromium
方案一，electron也曾经尝试过，在渲染进程里实现比较简单，但是在主进程里面就比较困难了，因为各个系统的GUI实现都不一样，比如Mac是NSRunLoop、linuv是glib，工程量很浩大，很多边界条件处理不好。后来作者使用一个小间隔定时器去轮询GUI事件，但是发现GUI响应特别慢。</li></ol> <p>后来，随着libuv引入了backend_fd的概念，相当于libuv轮询事件的文件描述符，通过轮询backend_fd，可以知道libuv的一个新事件，所以electron的做法就是将Node集成到chromium。</p> <p>Electron起了一个新的安全线程去轮询backend_fd，当node.js有了一个新的事件之后，通过postTask转发到我们的Chromium的事件循环当中，这样子就完成了Electron的事件融合。</p> <p><img src="https://mwpro.oss-cn-hangzhou.aliyuncs.com/7385/cfd641aef547e4bdd28ed63d1db6c72e" alt=""></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/electron/basic/44328ca765.html" class="prev">
        为什么electron那么🔥
      </a></span> <!----></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.311b719d.js" defer></script><script src="/assets/js/2.b192e365.js" defer></script><script src="/assets/js/9.9f67e139.js" defer></script>
  </body>
</html>
